<multiscale>
    <info>
        <job appID="bac-compat" project="compat">
            <computing> RC </computing>
            <modeltime> namd_kernel + amber_kernel </modeltime>
	    
	     <task taskId="namd" persistent="true">
                <numberofcores>
                    <min> 1 </min>
                    <max> 1024 </max>
                </numberofcores>
		<totaliterations> 10 </totaliterations>
		<note>namd ${PS_rep}</note>
            </task>

		<task taskId="amber" extension="namd_PSit${PS_it}">        
                <numberofcores>
                    <min> 1 </min>
                    <max> 1 </max>
                </numberofcores>
		<totaliterations> 10 </totaliterations>
		<note>amber ${PS_rep}</note>
            </task>

        </job>
    </info>
  
	<topology>
		<instance id="namd_kernel" submodel="namd_kernel"/>
		<instance id="amber_kernel" submodel="amber_kernel"/>
	</topology>

    <middleware name="QCG">
    
	<task taskId="namd">
        		<execution type="compat">
			<executable>
				<application name="bash"/>
			</executable>
			<arguments>
				<value>bac-namd.sh</value>
				<value>${PS_rep}</value>
			</arguments>
			<stageInOut>
				<file name="bac-namd.sh" type="in">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/muc-bac-namd.sh</location>
				</file>
				<directory name="input" type="in">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/input</location>
				</directory>
				<file name="qcg.debug" type="out">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/output/output-muc-${JOB_ID}-namd-rep${PS_rep}.qcg.debug</location>
				</file>
				<file name="_stdouterr" type="out">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/output/output-muc-${JOB_ID}-namd-rep${PS_rep}.stdouterr</location>
				</file>
			</stageInOut>
		</execution>
		<parametersSweep>
			<parameter>
				<name>rep</name>
				<value>
					<loop>
						<start>1</start>
						<end>16</end>
						<step>1</step>
						<decimalPlaces>0</decimalPlaces>
					</loop>
				</value>
			</parameter>
		</parametersSweep>
	</task>
	
	<task taskId="amber">
		<execution type="compat">
			<executable>
				<application name="bash"/>
			</executable>
			<arguments>
				<value>bac-amber.sh</value>
				<value>${PS_rep}</value>
			</arguments>
			<stageInOut>
				<file name="bac-amber.sh" type="in">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/muc-bac-amber.sh</location>
				</file>
				<directory name="input/replicas/rep${PS_rep}" type="out">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/output/output-muc-${JOB_ID}-rep${PS_rep}</location>
				</directory>
				<file name="qcg.debug" type="out">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/output/output-muc-${JOB_ID}-amber-rep${PS_rep}.qcg.debug</location>
				</file>
				<file name="amber.log" type="out">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/output/output-muc-${JOB_ID}-amber-rep${PS_rep}.log</location>
				</file>
				<file name="_stdouterr" type="out">
					<location type="URL">gsiftp://qcg.man.poznan.pl/compat/bac-xml/output/output-muc-${JOB_ID}-amber-rep${PS_rep}.stdouterr</location>
				</file>
			</stageInOut>
		</execution>
		<workflow>
			<parent triggerState="FINISHED">namd_PSit${PS_it}</parent>
		</workflow>
		<parametersSweep>
			<parameter>
				<name>it</name>
				<value>
					<loop>
						<start>0</start>
						<end>15</end>
						<step>1</step>
						<decimalPlaces>0</decimalPlaces>
					</loop>
				</value>
			</parameter>
			<parameter>
				<name>rep</name>
				<value>
					<loop>
						<start>1</start>
						<end>16</end>
						<step>1</step>
						<decimalPlaces>0</decimalPlaces>
					</loop>
				</value>
			</parameter>
		</parametersSweep>
	</task>
	
    </middleware>
</multiscale>
